/**
 * msharp.js
 * v1.0.0 (Thu, 14 Feb 2013 20:56:21 GMT)
 *
 * By Martin Eriksson
 *
 * MIT License.
 */
;(function(){function t(){}function e(t){this.message+=t}function r(t){this.message=t+this.message}function n(t){this.message=t+this.message}function o(t){this.message=t+this.message}function i(t){this.message=t+this.message}"undefined"==typeof DEBUG&&(DEBUG=!0);var s=Function,u=s("return this")();e.prototype=Error(),e.prototype.name="ArgumentError",e.prototype.message="Value provided for the following parameter is invalid: ",r.prototype=new e,r.prototype.name="ArgumentOutOfRangeError",r.prototype.message=" is out of range.",n.prototype=new e,n.prototype.name="ArgumentNullError",n.prototype.message=" is null.",o.prototype=Error(),o.prototype.name="NotImplementedError",o.prototype.message=" is not implemented.",i.prototype=Error(),i.prototype.name="ModuleNotFoundError",i.prototype.message=" is not defined. Please make sure the required script is referenced before this module.";var a=u.msharp={name:"msharp.js",version:"1.0.0",description:"yet another javascript framework.",author:"Martin Eriksson"};Object.defineProperties&&Object.defineProperties(a,{name:{value:a.name,writable:!1},version:{value:a.version,writable:!1},description:{value:a.description,writable:!1},author:{value:a.author,writable:!1}}),a.each=function(t,e,r){if("object"!=typeof t)throw new InvalidParameterError("object");if("function"!=typeof e)throw new TypeError("callback");var n=t.length,o=null,i=0;if(n===void 0){for(i in t)if(o=t[i],e.apply(r||o,[o,i])===!1)break}else for(;n>i&&(o=t[i],e.apply(r||o,[o,i])!==!1);i++);return t},a.equals=function(t,e){return t===e?!0:typeof t!=typeof e?!1:JSON.stringify(t)===JSON.stringify(e)},a.inherit=function(t,e){function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t},a.isArray=function(t){return t instanceof Array||"[object Array]"===Object.prototype.toString.call(t)},a.isNumber=function(t){return"number"===a.type(t)},a.isStrict=function(){try{}catch(t){return!0}return!1},a.mix=function(){var t=null,e={};return a.each(arguments,function(){for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t])}),e},a.namespace=function(t){if("string"!=typeof t)throw new InvalidParameterError("namespace");var e=t.split("."),r=u;return a.each(e,function(){r[this]===void 0&&(r[this]={}),r=r[this]}),r},a.require=function(t){if("string"!=typeof t)throw new TypeError("namespace");var e=t.split("."),r=u;return a.each(e,function(){if(r[this]===void 0)throw Error(t+" is not defined. Please make sure the required script is referenced before this module.");r=r[this]}),r},a.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},a.type=function(t){var e=Object.prototype.toString.call(t).match(/\[object (.+?)\]/i);if(!e)return typeof t;if("Object"===e[1]&&t.constructor&&t.constructor.name)return t.constructor.name.toLowerCase();if("Object"===e[1]&&t.constructor){var r=(""+t.constructor).match(/^function(.+?)\(/i);if(r&&r[1].trim())return r[1].toLowerCase().trim()}return e[1].toLowerCase()},String.prototype.trim=String.prototype.trim||function(){return a.trim(this)},u.console=u.console||{log:t,dir:t},function(t){t.Comparer=function(){function t(e,r){this.getType=function(){return e},this.compare=t.getComparerByType(e,r)}return t.booleanComparer=function(t,e){return e>t?-1:t>e?1:0},t.dateComparer=function(t,e){return t-e},t.numberComparer=function(t,e){return t-e},t.stringComparer=function(t,e){return e>t?-1:t>e?1:0},t.getComparerByType=function(e,r){var n=t[e+"Comparer"];return n!==void 0?r===!0?function(t,e){return n(e,t)}:n:void 0},t}()}(a),function(t){t.LambdaExpressionParser=function(){function e(t){var e=t.match(/\s*\(?\s*(.*)\s*\)?\s*=>\s*(.*)\s*/),r=[],n="";e.length>0&&e.shift(),e.length>0&&(n=e.pop()),e.length>0&&(r=e.pop().replace(/^\s*|\s(?=\s)|\s*$|,/g,"").split(" ")),e=(/\s*return\s+/.test(n)?"":"return ")+n,r.push(e);try{return Function.apply({},r)}catch(o){throw Error()}}function r(r){var n=null,o=typeof r;if("function"===o)n=r;else{if("string"!==o)throw new t.ArgumentError("expression");try{n=e(r)}catch(i){throw i}}this.getFunction=function(){return n}}function n(t){this.message="LambdaExpressionParser failed to parse the expression. Expression: '"+t+"'"}return n.prototype=Error(),n.prototype.name="LambdaExpressionParserError",r.LambdaExpressionParserError=n,r.prototype.apply=function(t,e){return this.getFunction().apply(t,e)},r}()}(a),function(t){var e=function(){function e(t){if(Array.call(this),t)for(var e=t.length,r=0;e>r;r++)this.push(t[r]);this.position=-1}return t.inherit(e,Array),e.isEnumerator=function(t){return t instanceof e},e.prototype.getCurrent=function(){try{return this[this.position]}catch(t){throw Error("The enumerator is positioned before the first element of the collection or after the last element.")}},e.prototype.moveNext=function(){return this.position++,this.position<this.length},e.prototype.each=function(e,r){return t.each(this,e,r)},e.prototype.reset=function(t){return this.position=-1,t},e.prototype.toArray=function(){return this.slice()},e}();if(JSON){var r=JSON.stringify;JSON.stringify=function(t,n,o){return r(t,function(t,r){var o=r instanceof e?r.toArray():r;return n?n(t,o):o},o)}}t.Enumerator=e}(a),function(t){var i=t.require("msharp.Enumerator"),s=t.require("msharp.LambdaExpressionParser");t.Enumerable=function(){function u(t){i.call(this,t)}function a(t){this.name="NoMatchError",this.message=t||"No element satisfies the condition in predicate."}function h(t){this.name="NoElementsError",this.message=t||"The source sequence is empty."}function c(t){this.name="MoreThanOneElementError",this.message=t||"There are more than one element in this Enumerable."}function p(t){this.name="IncompatibleElementTypesError",this.message=t||"Element types are not compatible."}return t.inherit(u,i),a.prototype=Error(),a.prototype.contructor=a,u.NoMatchError=a,h.prototype=Error(),h.prototype.constructor=h,u.NoElementsError=h,c.prototype=Error(),c.prototype.constructor=c,u.MoreThanOneElementError=c,p.prototype=Error(),p.prototype.constructor=p,u.IncompatibleElementTypesError=p,u.empty=function(){return new u},u.isEnumerable=function(t){return t instanceof u},u.range=function(t,e){if(0>e)throw new r("count");for(var n=new u,o=0;e>o;++o)n.push(t+o);return n},u.repeat=function(t,o){if(t===void 0)throw new n("element");if(o===void 0)throw new n("count");if("number"!=typeof o)throw new e("count");if(0>o)throw new r("count");for(var i=new u,s=0;o>s;s++)i.push(t);return i},u.prototype.contains=function(e,r){if(e===void 0)throw new n("value");var o=r||t.equals,i=!1;return this.each(function(t){return o(t,e)?(i=!0,!1):void 0}),i},u.prototype.count=function(t){if(t===void 0)return this.length;try{t=new s(t)}catch(r){throw new e("predicate")}var n=0;return this.each(function(e){t.apply(e,[e])&&n++}),n},u.prototype.distinct=function(t){var e=new u;return this.each(function(r){e.contains(r,t)||e.push(r)}),e},u.prototype.elementAt=function(t){if(t===void 0)throw new n("index");if("number"!=typeof t)throw new e("index");if(0>t||t>=this.length)throw new r("index");return this[t]},u.prototype.elementAtOrDefault=function(t,e){if(e===void 0)throw new n("defaultValue");try{return this.elementAt(t)}catch(o){if(o instanceof r)return e;throw o}},u.prototype.except=function(t){if(t===void 0)throw new n("second");if(!(t instanceof Array))throw new e("second");t instanceof u||(t=new u(t));var r=new u;return this.each(function(e){t.contains(e)||r.push(e)}),r},u.prototype.first=function(t){if(0===this.length)throw new h;if(t)try{t=new s(t)}catch(r){throw new e("predicate")}var n;if(this.each(function(e,r){return(t?t.apply(this,[this]):0===r)?(n=this,!1):void 0}),n!==void 0)return n;throw new a},u.prototype.firstOrDefault=function(){var t,e;if(arguments.length>=2)t=arguments[0],e=arguments[1];else{if(1!==arguments.length)throw new n("predicate");e=arguments[0]}try{return this.first(t)}catch(r){if(r instanceof a||r instanceof h)return e;throw r}},u.prototype.groupBy=function(r,o){if(r===void 0)throw new n("keySelector");try{r=new s(r)}catch(i){throw new e("keySelector")}if(o)try{o=new s(o)}catch(i){throw new e("elementSelector")}var a=new u,h=new u,c=null,p=null,f=null,w=new u;for(this.each(function(){c=r.apply(this,[this]),p=o?o.apply(this,[this]):this,f=a.indexOf(c,function(t,e){return t==e}),f>=0?h.elementAt(f).push(p):(a.push(c),h.push([p]))});a.moveNext()&&h.moveNext();)w.push(new t.Grouping(a.getCurrent(),h.getCurrent()));return w},u.prototype.indexOf=function(e,r){if(e===void 0)throw new n("value");var o=r||t.equals,i=-1;return this.each(function(t,r){return o(this,e)?(i=r,!1):void 0}),i},u.prototype.last=function(t){var r=null,n=!1,o=0;if(t){try{t=new s(t)}catch(i){throw new e("predicate")}if(this.each(function(){t.apply(this,[this])&&(r=this,n=!0)}),n)return r;throw new a}if(o=this.count(),o>0)return this.elementAt(o-1);throw new h},u.prototype.lastOrDefault=function(){var t,e;if(arguments.length>=2)t=arguments[0],e=arguments[1];else{if(1!==arguments.length)throw new n("defaultValue");e=arguments[0]}try{return this.last(t)}catch(r){if(r instanceof a||r instanceof h)return e;throw r}},u.prototype.max=function(e){var r,n=e!==void 0?this.select(e):this,o=!1;if(n.each(function(){if(t.isNumber(this)===!1)throw new p;o?this>r&&(r=this):(r=this,o=!0)}),o)return r;throw new h},u.prototype.min=function(e){var r,n=e!==void 0?this.select(e):this,o=!1;if(n.each(function(){if(t.isNumber(this)===!1)throw new p;o?r>this&&(r=this):(r=this,o=!0)}),o)return r;throw new h},u.prototype.ofType=function(r){if(r===void 0)throw new n("type");if("string"!=typeof r&&"function"!=typeof r)throw new e("type");var o=new u,i=null;return"string"==typeof r?i=function(e,r){return t.type(e)===r.toLowerCase()}:"function"==typeof r&&(i=function(t,e){return t instanceof e}),this.each(function(){i(this,r)&&o.push(this)}),o},u.prototype.orderBy=function(r,n){if(r)try{r=new s(r)}catch(o){throw new e("keySelector")}if(n)try{n=new s(n).getFunction()}catch(o){throw new e("comparer")}var a,h=new i,c=new u,f=null,w=!1;return this.each(function(e,o){if(f=r?r.apply(this,[this]):this,!n)if(w){if(a!==t.type(f))throw new p}else a=t.type(f),w=!0;h.push({index:o,key:f})}),n===void 0&&(n=t.Comparer.getComparerByType(a)),h.sort(n&&function(t,e){return n(t.key,e.key)}),h.each(function(t,e){c.push(this[h[e].index])},this),c},u.prototype.orderByDescending=function(t,e){return this.orderBy(t,e).reverse()},u.prototype.reverse=function(){return new u(this.toArray().reverse())},u.prototype.select=function(t){if(t===void 0)throw new n("selector");if("function"!=typeof t&&"string"!=typeof t)throw new e("selector");try{t=new s(t)}catch(r){throw new e("selector")}var o=new u;return this.each(function(e,r){o.push(t.apply(this,[this,r]))}),o},u.prototype.selectMany=function(t){if(t===void 0)throw new n("selector");try{t=new s(t)}catch(r){throw new e("selector")}var o=new u,a=null;return this.each(function(e,r){a=t.apply(this,[this,r]),a instanceof Array?(a=new i(a),a.each(function(){o.push(this)})):o.push(a)}),o},u.prototype.single=function(t){var r=0,n=null;if(t){try{t=new s(t)}catch(o){throw new e("predicate")}this.each(function(e){if(t.apply(e,[e])){if(r++>1)return!1;n=this}})}else if(r=this.count(),1===r)n=this.elementAt(0);else if(0===r)throw new h;if(1>r)throw new a;if(r>1)throw new c;return n},u.prototype.singleOrDefault=function(){var t,e;if(arguments.length>=2)t=arguments[0],e=arguments[1];else{if(1!==arguments.length)throw new n("defaultValue");e=arguments[0]}try{return this.single(t)}catch(r){if(r instanceof h||r instanceof a)return e;throw r}},u.prototype.skip=function(t){if(t===void 0)throw new n("count");if("number"!=typeof t)throw new e("count");var r=new u;return this.each(function(e,n){n>=t&&r.push(this)}),r},u.prototype.skipWhile=function(t){if(t===void 0)throw new n("predicate");try{t=new s(t)}catch(r){throw new e("predicate")}var o=new u,i=!1;return this.each(function(e,r){i||t.apply(this,[this,r])||(i=!0),i&&o.push(this)}),o},u.prototype.sum=function(t){if(t!==void 0)try{t=new s(t)}catch(r){throw new e("selector")}var n=0,o=0;return this.each(function(){if(n=t?t.apply(this,[this]):this,"number"!=typeof n){if(!(n instanceof Number&&n.valueOf))throw new p;n=n.valueOf()}o+=n}),o},u.prototype.take=function(t){if(t===void 0)throw new n("count");if("number"!=typeof t)throw new e("count");var r=new u;return this.each(function(e,n){return r.push(this),n>=t?!1:void 0}),r},u.prototype.takeWhile=function(t){if(t===void 0)throw new n("predicate");try{t=new s(t)}catch(r){throw new e("predicate")}var o=new u;return this.each(function(e,r){return t.apply(this,[this,r])?(o.push(this),void 0):!1}),o},u.prototype.thenBy=function(){throw new o("Enumerable.thenBy()")},u.prototype.thenByDescending=function(){throw new o("Enumerable.thenByDescending()")},u.prototype.union=function(t,r){if(t===void 0)throw new n("second");if(!(t instanceof Array))throw new e("second");var o=t instanceof u?t.toArray():t,i=new u(this.toArray().concat(o));return i.distinct(r)},u.prototype.where=function(t){if(t===void 0)throw new n("predicate");try{t=new s(t)}catch(r){throw new e("predicate")}var o=new u;return this.each(function(e,r){t.apply(this,[this,r])&&o.push(this)}),o},u.prototype.zip=function(t,r){if(t===void 0)throw new n("second");if(!(t instanceof Array))throw new e("second");if(r===void 0)throw new n("resultSelector");for(var o=new u(this),i=new u(t),s=new u;o.moveNext()&&i.moveNext();)s.push(r.apply(o.getCurrent(),[o.getCurrent(),i.getCurrent()]));return s},Array.prototype.toEnumerable===void 0&&(Array.prototype.toEnumerable=function(){return new u(this)}),u}()}(a),function(t){var e=t.require("msharp.Enumerable");t.Grouping=function(){function r(t,r){this.key=t,e.call(this,r)}return t.inherit(r,e),r}()}(a),function(t){var e=t.require("msharp.Enumerable"),r=function(){function r(t){e.call(this,t)}return t.inherit(r,e),r.isList=function(t){return t instanceof r},r.prototype.add=function(e){if(e===void 0)throw new t.ArgumentNullError("item");this.push(e)},r.prototype.addRange=function(e){if(e===void 0)throw new t.ArgumentNullError("collection");if(!(e instanceof Array))throw new t.ArgumentError("collection");if(e instanceof Array)for(var r=0;e.length>r;r++)this.add(e[r])},r.prototype.clear=function(){this.length=0},r.prototype.remove=function(e,r){if(e===void 0)throw new t.ArgumentNullError("item");for(var n=r||t.isEqual,o=0;this.length>o;o++){var i=this[o];if(n.call(i,i,e))return this.splice(o,1),!0}return!1},r.prototype.removeAll=function(e){if(e===void 0)throw new t.ArgumentNullError("match");if("function"!=typeof e)throw new t.ArgumentException("match");var r,n=0,o=this.length-1;for(r=o;r>=0;r--)e.call(this[r],this[r])||(this.splice(r,1),n++);return n},r.prototype.removeAt=function(e){if(e===void 0)throw new t.ArgumentNullError("index");if("number"!=typeof e)throw new t.ArgumentError("index");if(0>e||e>this.length-1)throw new t.ArgumentOutOfRangeError("index");this.splice(e,1)},r.prototype.removeRange=function(e,r){if(e===void 0)throw new t.ArgumentNullError("index");if("number"!=typeof e)throw new t.ArgumentError("index");if(r===void 0)throw new t.ArgumentNullError("count");if("number"!=typeof r||e+r>this.length)throw new t.ArgumentError("count");if(0>e||e>this.length-1)throw new t.ArgumentOutOfRangeError("index");if(0>r)throw new t.ArgumentOutOfRangeError("count");this.splice(e,r)},Array.prototype.toList===void 0&&(Array.prototype.toList=function(){return new r(this)}),r}();t.List=r}(a)})(this);;